## Теоретическая часть
Виртуальной компьютерной(локальной) сетью(Virtual Local Area Network сокр. VLAN) называется группа узлов сети, трафик которой, в том числе и широковещательный, на канальном уровне полностью изолирован от других узлов сети. В такой сети передача кадров между разными виртуальными сетями на основании адреса канального уровня невозможна, независимо от типа адреса - уникального, группового или широковещательного. В то же время внутри виртуальной сети кадры передаются по технологии коммутации, то есть только на тот порт, который связан с адресом назначения кадра.

Назначение технологии виртуальных компьютерных сетей состоит в облегчении процесса сегментирования сети без необходимости физического сегментирования, которые затем должны связываться с помощью маршрутизаторов, реализующих какой-либо протокол сетевого уровня, например IP. Такое построение сети создает гораздо более гибкую, производительную и защищенную от ошибочного трафика сеть. На сегодняшний день, считается, что любая крупная сеть должна включать маршрутизаторы, иначе потоки ошибочных кадров, например широковещательных, будут периодически затапливать всю сеть через прозрачные для них коммутаторы, приводя ее в неработоспособное состояние.

До появления технологии VLAN для создания отдельной сети использовались либо физически изолированные сегменты коаксиального кабеля, либо несвязанные между собой сегменты, построенные на повторителях и мостах. Затем эти сети связывались маршрутизаторами в единую составную сеть.

![изображение](https://github.com/user-attachments/assets/b65e84fe-3eec-432d-952e-cd7649ff78b4)

Принцип работы виртуальной сети заключается в том, что коммутатор идентифицирует пакеты из разных VLAN в соответствии с информацией кадра, который содержит тег VLAN и отправляет его в нужную сеть.

Обычный пакет:

![изображение](https://github.com/user-attachments/assets/56401693-1054-4ee3-8e82-4c50649add96)

Пакет с тегом VLAN:

![изображение](https://github.com/user-attachments/assets/cecd8e79-f036-4891-bded-05e77adf6ca6)

Преимущества использования VLAN:
1. Сети VLAN можно использовать для сегментации сети на более мелкие и более управляемые участки, без необходимости физической изоляции.
2. Сети VLAN могут повысить безопасность, изолируя трафик и отделяя его от других типов трафика.
3. Сети VLAN могут повысить производительность за счет сокращения широковещательного трафика и доменов коллизий.

```Широковещательный трафик — это данные, которые отправляются на все устройства в сети независимо от того, нужны они им или нет. Разделяя устройства на разные виртуальные локальные сети, можно контролировать, какие широковещательные рассылки получает каждое устройство, что может помочь повысить производительность сети.```

Также, виртуальные сети могут подразделяться по следующим типам трафика:
1. Data VLAN — это VLAN, которая передает пользовательский трафик данных. Data VLAN также известны как пользовательские VLAN. Всем портам коммутатора, входящим в сеть VLAN данных, назначается один и тот же идентификатор VLAN.
2. Voice VLAN — это особый тип VLAN для передачи данных, настроенный для передачи голосового трафика в реальном времени. Голосовые VLAN отдают приоритет голосовому трафику по сравнению с другими типами трафика, и всем портам коммутатора, являющимся членами голосовой VLAN, назначается одно и то же значение Voice Class of Service (CoS).
3. VLAN для наблюдения — это особый тип VLAN для передачи данных, настроенный для передачи видеотрафика в реальном времени. VLAN наблюдения отдают приоритет голосовому трафику по сравнению с другими типами трафика, и всем портам коммутатора, которые являются членами VLAN наблюдения, назначается одно и то же значение класса обслуживания голоса (CoS).
4. VLAN управления — это особый тип VLAN данных, который используется для передачи внеполосного трафика управления для устройств в сети, таких как коммутаторы, маршрутизаторы и брандмауэры. VLAN управления обычно используют IP-адреса, которые не маршрутизируются в общедоступном Интернете.
5. VLAN по умолчанию — это конфигурация сетевого коммутатора, в которой все порты назначены одной VLAN. Это может упростить администрирование коммутатора, позволяя всем устройствам в одной сети VLAN взаимодействовать друг с другом без необходимости настройки отдельных сетей VLAN. Однако это также может создавать риски безопасности, позволяя несанкционированным устройствам получать доступ к конфиденциальным данным.
6. Native VLAN — это VLAN, по которой передается нетегированный трафик. Обычно это VLAN по умолчанию для новых портов на коммутаторе. Все устройства в родной VLAN могут взаимодействовать друг с другом без маркировки трафика.

Такое разделение трафика на разные виртуальные сети позволяет контролировать данные, создает безопасную среду их передачи, ограничивая их от других сетей.

Существует несколько способов работы VLAN:
1. Port-based VLAN - коммутация помеченных VLAN пакетов на связанных физических портах
2. Tagged VLAN - коммутация пакетов с пометкой VLAN тега
3. Untagged VLAN - коммутация пакетов с снятием VLAN тега
4. MAC-VLAN - коммутация пакетов определенных хостов с пометкой VLAN тега
5. Protocol-VLAN - коммутация определенного протокола с пометкой VLAN тега
6. Trunk-VLAN - коммутация пакетов уже помеченных VLAN тегом

Рассмотрим каждый подробнее:

1. Port-based VLAN (VLAN на основе портов) каждый порт коммутатора назначается определенной VLAN. Он является наиболее распространенным типом, в котором каждый порт сетевого коммутатора назначается определенной виртуальной сети. Как правило, виртуальные локальные сети на основе портов используются в сетях малых и домашних офисов (SOHO). Основное преимущество использования VLAN на основе портов простая и быстрая настройка для работы.

Во время настройки Ethernet-порт коммутатора может работать в трех режимах: Access, Trunk и Hybrid, каждый режим имеет различный метод обработки при передаче кадров с тэгом или без.

- Порт в режиме Access относится только к одному VLAN, обычно используется для подключения конечных устройств, таких как персональный компьютер или WI-FI маршрутизатор в квартире или офисе.
- Порт в режиме Trunk относится к нескольким VLAN и может принимать и отправлять кадры одновременно в нескольких VLAN. Обычно используется для соединения коммутаторов.
- Порт в режиме Hybrid, также как и Trunk, относится к нескольким VLAN и может принимать и отправлять кадры одновременно в нескольких VLAN. Может использоваться как для подключения персональных компьютеров, так и для соединения коммутаторов.

```Ethernet-порты в режимах Hybrid и Trunk могут принимать данные одним, но отправляют разными способами: Hybrid порт может отправлять пакеты в нескольких VLAN в нетэгированном виде, в то время как Trunk может отправлять трафик в нескольких VLAN только с тэгом, за исключением nativeVLAN.```

2. Tagged VLAN (VLAN на основе тегов) использует специальные теги для определения того, какой виртуальной сети принадлежит пакет, это позволяет назначать несколько VLAN одному порту. Таким образом, он является более гибким, чем VLAN на основе портов. Как правило, виртуальные локальные сети на основе тегов используются в корпоративных сетях.

3. Untagged VLAN (VLAN снятия тегов) снимает специальные теги с пакетов приходящик на порт. Так как хосты отправляют нетегированный трафик, необходимо снимать тег с пакетов отправляемых хосту, в ином случае пакет будет отброшен.

```Для организации корпоративной виртуальной сети на основе Tagged/Untagged необходимо предварительно составить логическую схему для корректной настройки, ее дальнейшей поддержки и быстрого восстановления при возникновении проблем.```

4. MAC-VLAN (VLAN на основе MAC-адресов) работают, позволяя назначать входящие нетегированные пакеты виртуальным локальным сетям, таким образом классифицируя трафик на основе адреса источника пакетов. Это позволяет более точно управлять VLAN трафиком на порту.

4. Protocol-VLAN (VLAN для протоколов) помечает пакеты определенных протоколов специальными тегами для определения того, какой виртуальной сети принадлежит пакет, это позволяет контролировать трафик протоколов на порту, повышая безопасность работы некоторых протоколов в сети.

5. Trunk VLAN передает тегированный трафик от одного либо нескольких VLAN по одному физическому каналу. Это обеспечивает большую гибкость и эффективность при настройке сетевых устройств. При настройке транкинга VLAN используется собственный уникальный идентификатор (ID) для указания того, какой трафик следует отправлять по транковому каналу.

Существует два основных преимущества использования транкинга VLAN. Во-первых, это может помочь улучшить производительность сети за счет уменьшения перегрузки в сети. Во-вторых, он может обеспечить большую безопасность, изолируя трафик из разных VLAN. Это может помочь предотвратить несанкционированный доступ к конфиденциальным данным.

```Есть несколько моментов, о которых следует помнить при настройке транкинга VLAN. Во-первых, важно убедиться, что порты коммутатора настроены правильно. Во-вторых, идентификатор каждой VLAN должен быть уникальным и не должен использоваться повторно в других частях сети. Наконец, важно протестировать конфигурацию перед ее развертыванием в рабочей среде.```

Также некоторые коммутаторы имеют возможность создания двойного VLAN (QinQ). Двойная VLAN — это две виртуальные локальные сети, настроенные для совместной работы.

В компьютерных сетях тегирование QinQ — это метод, используемый для расширения возможностей виртуальных локальных сетей (VLAN). Вместо того, чтобы иметь одну VLAN для каждого клиента, QinQ позволяет передавать несколько VLAN по одному физическому каналу. Это может быть полезно в ситуациях, когда клиентам необходимо подключиться к нескольким виртуальным локальным сетям или когда провайдерам необходимо предлагать разные уровни обслуживания в одной и той же физической инфраструктуре.
Тегирование QinQ было впервые разработано Cisco Systems и иногда упоминается как «маршрутизация Cisco Inter-Switch Link (ISL)». В настоящее время это протокол промышленного стандарта, который поддерживается большинством крупных поставщиков сетевых услуг.

Существует несколько преимуществ использования двойной VLAN. Например, если у вас есть конфиденциальные данные в одной сети VLAN, которые вы хотите защитить, вы можете использовать вторую сеть VLAN в качестве демилитаризованной зоны. Это позволит вам сохранить данные в безопасности, сохраняя при этом доступ к ним из Интернета. Еще одним преимуществом использования двойной сети VLAN является то, что она помогает повысить производительность сети. Разделяя трафик на разные виртуальные локальные сети, вы можете уменьшить перегрузку и повысить общую пропускную способность. Наконец, использование двойной VLAN может повысить безопасность за счет обеспечения избыточности. Если одна VLAN будет скомпрометирована, другая по-прежнему сможет предоставлять доступ к критически важным ресурсам.
В целом использование двойной конфигурации VLAN дает много преимуществ если необходимо повысить безопасность и производительность или гибкость сети.

Для реализации маркировки QinQ каждой клиентской VLAN присваивается уникальный глобальный идентификатор моста поставщика услуг (S-TAG). S-TAG используется для идентификации клиентской VLAN, когда она передается по сети провайдера. Когда клиентская VLAN достигает пункта назначения, S-TAG удаляется и восстанавливается исходный идентификатор клиентской VLAN.

Маркировка QinQ может использоваться в сочетании с другими методами, такими как качество обслуживания (QoS), для предоставления различных уровней обслуживания различным клиентам. Например, повысить приоитет директору или провайдер может отдать более высокий приоритет клиентам, которые платят за премиум-уровень обслуживания.
В целом, Маркировка QinQ обеспечивает гибкий способ расширения возможностей VLAN, сохраняя при этом совместимость с существующим сетевым оборудованием и программным обеспечением.

В случае когда необходима маршрутизация между VLAN требуется коммутатор с поддержкой сетевого уровня модели OSI(L3) или маршрутизатор с поддержкой 802.1Q.
Методы настройки маршрутизации между VLAN:

1. Отдельное подключение к маршрутизатору для каждой VLAN Они могут быть транками или портами доступа. Это происходит довольно редко, поскольку при наличии большого количества VLAN понадобится много интерфейсов, а у маршрутизаторов обычно их всего несколько.

![изображение](https://github.com/user-attachments/assets/1fad4bb3-983e-4d03-b2df-d59c7c81da72)


2. Использование router on a stick, который представляет собой магистральное соединение между коммутатором и маршрутизатором

![изображение](https://github.com/user-attachments/assets/f64feab4-a583-4cca-adec-54d1f6dbb75e)


3. Использование виртуального интерфейса на многоуровневом коммутаторе (SVI)

![изображение](https://github.com/user-attachments/assets/ae954d93-065a-4f48-9b61-19f5e19eec68)

Зачастую используется метод router on a stick когда на роутере настроены sub-интерфейсы.

https://www.azone-it.ru/articles-vlan

https://ftp.dlink.ru/pub/Trainings/SwitchWhitePapers/Q-in-Q_Port-Based_and_Selective.pdf

https://fiberroad.com/ru/resources/glossary/vlan-explained-what-is-vlan-how-does-it-work

https://www.dlink.ru/ru/faq/465/2030.html

https://www.qtech.ru/support/wiki/110/579/

https://www.dlink.ru/ru/faq/465/2030.html

